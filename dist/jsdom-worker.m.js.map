{"version":3,"file":"jsdom-worker.m.js","sources":["../node_modules/mitt/dist/mitt.es.js","../node_modules/uuid-v4/index.js","../src/index.js"],"sourcesContent":["//      \n// An event handler can take an optional event argument\n// and should not return a value\n                                          \n                                                               \n\n// An array of all currently registered event handlers for a type\n                                            \n                                                            \n// A map of event types and their corresponding event handlers.\n                        \n                                 \n                                   \n  \n\n/** Mitt: Tiny (~200b) functional event emitter / pubsub.\n *  @name mitt\n *  @returns {Mitt}\n */\nfunction mitt(all                 ) {\n\tall = all || Object.create(null);\n\n\treturn {\n\t\t/**\n\t\t * Register an event handler for the given type.\n\t\t *\n\t\t * @param  {String} type\tType of event to listen for, or `\"*\"` for all events\n\t\t * @param  {Function} handler Function to call in response to given event\n\t\t * @memberOf mitt\n\t\t */\n\t\ton: function on(type        , handler              ) {\n\t\t\t(all[type] || (all[type] = [])).push(handler);\n\t\t},\n\n\t\t/**\n\t\t * Remove an event handler for the given type.\n\t\t *\n\t\t * @param  {String} type\tType of event to unregister `handler` from, or `\"*\"`\n\t\t * @param  {Function} handler Handler function to remove\n\t\t * @memberOf mitt\n\t\t */\n\t\toff: function off(type        , handler              ) {\n\t\t\tif (all[type]) {\n\t\t\t\tall[type].splice(all[type].indexOf(handler) >>> 0, 1);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Invoke all handlers for the given type.\n\t\t * If present, `\"*\"` handlers are invoked after type-matched handlers.\n\t\t *\n\t\t * @param {String} type  The event type to invoke\n\t\t * @param {Any} [evt]  Any value (object is recommended and powerful), passed to each handler\n\t\t * @memberOf mitt\n\t\t */\n\t\temit: function emit(type        , evt     ) {\n\t\t\t(all[type] || []).slice().map(function (handler) { handler(evt); });\n\t\t\t(all['*'] || []).slice().map(function (handler) { handler(type, evt); });\n\t\t}\n\t};\n}\n\nexport default mitt;\n//# sourceMappingURL=mitt.es.js.map\n","\nexports = module.exports = function() {\n\tvar ret = '', value;\n\tfor (var i = 0; i < 32; i++) {\n\t\tvalue = exports.random() * 16 | 0;\n\t\t// Insert the hypens\n\t\tif (i > 4 && i < 21 && ! (i % 4)) {\n\t\t\tret += '-';\n\t\t}\n\t\t// Add the next random character\n\t\tret += (\n\t\t\t(i === 12) ? 4 : (\n\t\t\t\t(i === 16) ? (value & 3 | 8) : value\n\t\t\t)\n\t\t).toString(16);\n\t}\n\treturn ret;\n};\n\nvar uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/;\nexports.isUUID = function(uuid) {\n\treturn uuidRegex.test(uuid);\n};\n\nexports.random = function() {\n\treturn Math.random();\n};\n\n","import mitt from 'mitt';\r\nimport uuid from 'uuid-v4';\r\nimport fetch, { Response } from 'node-fetch';\r\n\r\nif (!global.URL) global.URL = {};\r\nif (!global.URL.$$objects) {\r\n\tglobal.URL.$$objects = new Map();\r\n\tglobal.URL.createObjectURL = blob => {\r\n\t\tlet id = uuid();\r\n\t\tglobal.URL.$$objects[id] = blob;\r\n\t\treturn `blob:http://localhost/${id}`;\r\n\t};\r\n\r\n\r\n\ttry {\r\n\t\tvar oldFetch = global.fetch || fetch__default;\r\n\t\tglobal.fetch = function (e, t) {\r\n\t\t\treturn new Promise(function (t, o) {\r\n\t\t\t\tvar n = new FileReader;\r\n\t\t\t\tn.onload = function () {\r\n\t\t\t\t\tvar e = global.Response || fetch.Response;\r\n\t\t\t\t\tt(new e(n.result, {\r\n\t\t\t\t\t\tstatus: 200,\r\n\t\t\t\t\t\tstatusText: \"OK\"\r\n\t\t\t\t\t}))\r\n\t\t\t\t}, n.onerror = function () {\r\n\t\t\t\t\to(n.error)\r\n\t\t\t\t};\r\n\t\t\t\tvar s = e.match(/[^/]+$/)[0];\r\n\t\t\t\tn.readAsText(global.URL.$$objects[s])\r\n\t\t\t})\r\n\t\t}\r\n\t} catch (err) { }\r\n\r\n}\r\n\r\nif (!global.document) {\r\n\tglobal.document = {};\r\n}\r\n\r\nfunction Event(type) { this.type = type; }\r\nEvent.prototype.initEvent = Object;\r\nif (!global.document.createEvent) {\r\n\tglobal.document.createEvent = function (type) {\r\n\t\tlet Ctor = global[type] || Event;\r\n\t\treturn new Ctor(type);\r\n\t};\r\n}\r\n\r\n\r\nglobal.Worker = function Worker(url) {\r\n\tlet messageQueue = [],\r\n\t\tinside = mitt(),\r\n\t\toutside = mitt(),\r\n\t\tscope = {\r\n\t\t\tonmessage: null,\r\n\t\t\tdispatchEvent: inside.emit,\r\n\t\t\taddEventListener: inside.on,\r\n\t\t\tremoveEventListener: inside.off,\r\n\t\t\tpostMessage(data) {\r\n\t\t\t\toutside.emit('message', { data });\r\n\t\t\t},\r\n\t\t\tfetch: global.fetch,\r\n\t\t\timportScripts(...urls) { }\r\n\t\t},\r\n\t\tgetScopeVar;\r\n\tinside.on('message', e => { let f = getScopeVar('onmessage'); if (f) f.call(scope, e); });\r\n\tthis.addEventListener = outside.on;\r\n\tthis.removeEventListener = outside.off;\r\n\tthis.dispatchEvent = outside.emit;\r\n\toutside.on('message', e => { this.onmessage && this.onmessage(e); });\r\n\tthis.postMessage = data => {\r\n\t\tif (messageQueue != null) messageQueue.push(data);\r\n\t\telse inside.emit('message', { data });\r\n\t};\r\n\tthis.terminate = () => {\r\n\t\tthrow Error('Not Supported');\r\n\t};\r\n\tglobal.fetch(url)\r\n\t\t.then(r => r.text())\r\n\t\t.then(code => {\r\n\t\t\tlet vars = 'var self=this,global=self';\r\n\t\t\tfor (let k in scope) vars += `,${k}=self.${k}`;\r\n\t\t\tgetScopeVar = eval('(function() {' + vars + ';\\n' + code + '\\nreturn function(__){return eval(__)}})').call(scope);\r\n\t\t\tlet q = messageQueue;\r\n\t\t\tmessageQueue = null;\r\n\t\t\tq.forEach(this.postMessage);\r\n\t\t})\r\n\t\t.catch(e => { });\r\n};\r\n"],"names":["mitt","all","Object","create","on","type","handler","push","off","splice","indexOf","emit","evt","slice","map","exports","module","value","ret","i","random","toString","uuidRegex","uuid","test","Math","global","URL","$$objects","Map","createObjectURL","blob","id","fetch","e","t","Promise","o","n","FileReader","onload","Response","result","status","statusText","onerror","error","s","match","readAsText","err","Event","document","prototype","initEvent","createEvent","Worker","url","messageQueue","inside","outside","scope","onmessage","dispatchEvent","addEventListener","removeEventListener","postMessage","data","importScripts","getScopeVar","f","call","this","terminate","Error","then","r","text","code","vars","let","k","eval","q","forEach","catch"],"mappings":"8BAmBA,SAASA,KAAKC,GAGb,OAFAA,EAAMA,GAAOC,OAAOC,OAAO,MAEpB,CAQNC,GAAI,SAAYC,EAAcC,IAC5BL,EAAII,KAAUJ,EAAII,GAAQ,KAAKE,KAAKD,IAUtCE,IAAK,SAAaH,EAAcC,GAC3BL,EAAII,IACPJ,EAAII,GAAMI,OAAOR,EAAII,GAAMK,QAAQJ,KAAa,EAAG,IAYrDK,KAAM,SAAcN,EAAcO,IAChCX,EAAII,IAAS,IAAIQ,QAAQC,IAAI,SAAUR,GAAWA,EAAQM,MAC1DX,EAAI,MAAQ,IAAIY,QAAQC,IAAI,SAAUR,GAAWA,EAAQD,EAAMO,qICxDnEG,EAAUC,UAAiB,WAE1B,IADA,IAAcC,EAAVC,EAAM,GACDC,EAAI,EAAGA,EAAI,GAAIA,IACvBF,EAA2B,GAAnBF,EAAQK,SAAgB,EAE5BD,EAAI,GAAKA,EAAI,MAASA,EAAI,KAC7BD,GAAO,KAGRA,IACQ,KAANC,EAAY,EACL,KAANA,EAAqB,EAARF,EAAY,EAAKA,GAE/BI,SAAS,IAEZ,OAAOH,GAGR,IAAII,EAAY,wEAChBP,SAAiB,SAASQ,GACzB,OAAOD,EAAUE,KAAKD,IAGvBR,SAAiB,WAChB,OAAOU,KAAKL,YCpBb,GADKM,OAAOC,MAAKD,OAAOC,IAAM,KACzBD,OAAOC,IAAIC,UAAW,CAC1BF,OAAOC,IAAIC,UAAY,IAAIC,IAC3BH,OAAOC,IAAIG,yBAAkBC,OACxBC,EAAKT,gBACTG,OAAOC,IAAIC,UAAUI,GAAMD,2BACKC,OAMhCN,OAAOO,MAAQ,SAAUC,EAAGC,UACpB,IAAIC,QAAQ,SAAUD,EAAGE,OAC3BC,EAAI,IAAIC,WACZD,EAAEE,OAAS,eACNN,EAAIR,OAAOe,UAAYR,MAAMQ,SACjCN,EAAE,IAAID,EAAEI,EAAEI,OAAQ,CACjBC,OAAQ,IACRC,WAAY,SAEXN,EAAEO,QAAU,WACdR,EAAEC,EAAEQ,YAEDC,EAAIb,EAAEc,MAAM,WAAU,GAC1BV,EAAEW,WAAWvB,OAAOC,IAAIC,UAAUmB,OAGnC,MAAOG,KAQV,SAASC,MAAM9C,QAAaA,KAAOA,EAJ9BqB,OAAO0B,WACX1B,OAAO0B,SAAW,IAInBD,MAAME,UAAUC,UAAYpD,OACvBwB,OAAO0B,SAASG,cACpB7B,OAAO0B,SAASG,YAAc,SAAUlD,UAEhC,IADIqB,OAAOrB,IAAS8C,OACX9C,KAKlBqB,OAAO8B,OAAS,SAASA,OAAOC,qBAC3BC,aAAe,GAClBC,OAAS3D,OACT4D,QAAU5D,OACV6D,MAAQ,CACPC,UAAW,KACXC,cAAeJ,OAAOhD,KACtBqD,iBAAkBL,OAAOvD,GACzB6D,oBAAqBN,OAAOnD,IAC5B0D,qBAAYC,GACXP,QAAQjD,KAAK,UAAW,MAAEwD,KAE3BlC,MAAOP,OAAOO,MACdmC,kFAEDC,YACDV,OAAOvD,GAAG,mBAAW8B,OAAWoC,EAAID,YAAY,aAAkBC,GAAGA,EAAEC,KAAKV,MAAO3B,UAC9E8B,iBAAmBJ,QAAQxD,QAC3B6D,oBAAsBL,QAAQpD,SAC9BuD,cAAgBH,QAAQjD,KAC7BiD,QAAQxD,GAAG,mBAAW8B,UAAY4B,WAAaU,OAAKV,UAAU5B,UACzDgC,qBAAcC,GACE,MAAhBT,aAAsBA,aAAanD,KAAK4D,GACvCR,OAAOhD,KAAK,UAAW,MAAEwD,UAE1BM,2BACEC,MAAM,kBAEbhD,OAAOO,MAAMwB,KACXkB,cAAKC,UAAKA,EAAEC,SACZF,cAAKG,UACDC,KAAO,gCACNC,IAAIC,KAAKpB,MAAOkB,MAAS,IAAGE,WAAUA,EAC3CZ,YAAca,KAAK,gBAAkBH,KAAO,MAAQD,KAAO,4CAA4CP,KAAKV,WACxGsB,EAAIzB,aACRA,aAAe,KACfyB,EAAEC,QAAQZ,OAAKN,eAEfmB,eAAMnD"}